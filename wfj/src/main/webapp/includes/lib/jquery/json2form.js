/*	jQuery json2form Plugin 
 *	version: 1.0 (2011-03-01)
 *
 * 	Copyright (c) 2011, Crystal, shimingxy@163.com
 * 	Dual licensed under the MIT and GPL licenses:
 * 	http://www.opensource.org/licenses/mit-license.php
 * 	http://www.gnu.org/licenses/gpl.html
 * 	Date: 2011-03-01 rev 1
 */

!function(t){t.json2form=t.json2form||{},t.fn.json2form=function(e){var a=this,e=t.extend({url:null,elem:this.attr("id"),type:"GET"},e||{});if(e.url&&t.restAjax({type:e.type,url:e.url,data:e.data,dataType:"json",async:!1,success:function(t){e.data=t.result,"function"==typeof e.callback&&e.callback(e.data)}}),!a.attr("loadedInit")){if(e.data.init)for(var s in e.data.init){var i=e.data.init[s];if(t("#"+e.elem+" input[name='"+s+"']")){var l=t("#"+e.elem+" input[name='"+s+"']").attr("type"),c=t("#"+e.elem+" input[name='"+s+"']").attr("name"),r=t("#"+e.elem+" input[name='"+s+"']");switch(l){case"checkbox":case"radio":for(var n in i)r.after('<input type="'+l+'"  name="'+c+'" value="'+i[n].value+'" />'+i[n].display);r.remove()}}if(t("#"+e.elem+" select[name='"+s+"']"))for(var n in i)t("#"+e.elem+" select[name='"+s+"']").append("<option value='"+i[n].value+"'>"+i[n].display+"</option>")}e.data.label&&t("#"+e.elem+" label").each(function(){var a=t(this).attr("for");e.data.label[a]&&t(this).html(e.data.label[a])}),e.iflabel&&a.find("label.input-label").each(function(){var a=t(this).attr("name"),s=e.data[a];if(a){var i=a.split(".");if(i.length>1&&(s=e.data[i[0]]))for(var l=1;l<i.length;l++)s=s[i[l]]}"string"==typeof s?t(this).data("chks")?t(this).html(t(this).data("chks")[s]):t(this).html("NULL"==s.toUpperCase()?"&nbsp;-":""==s?"&nbsp;-":"&nbsp;"+s):t(this).data("chks")?t(this).html(t(this).data("chks")[s]):t(this).html("&nbsp;"+s)})}e.data&&t("#"+e.elem+" input,select,textarea").each(function(){var a=void 0==t(this).attr("type")?this.type:t(this).attr("type"),s=t(this).attr("name"),i=e.data[s];if(s){var l=s.split(".");if(l.length>1&&(i=e.data[l[0]]))for(var c=1;c<l.length;c++)i=i[l[c]]}if(!t("#"+e.elem).attr("loadedInit")&&t(this).attr("loadurl"))switch(a){case"checkbox":case"radio":case"select":case"select-one":case"select-multiple":var r=this;t.ajax({type:e.type,url:t(this).attr("loadurl"),dataType:"json",async:!1,success:function(e){"select"!=a&&"select-one"!=a&&"select-multiple"!=a||t(r).empty();for(var i in e)"select"==a||"select-one"==a||"select-multiple"==a?t(r).append("<option value='"+e[i].value+"'>"+e[i].display+"</option>"):t(r).after('<input type="'+a+'"  name="'+s+'" value="'+e[i].value+'" />'+e[i].display);"checkbox"!=a&&"radio"!=a||t(r).remove()}})}if(i||0==i)switch(a){case void 0:case"text":case"password":case"hidden":case"button":case"reset":case"textarea":case"submit":"string"==typeof i?t(this).val("NULL"==i.toUpperCase()?"":i):t(this).val(i+"");break;case"checkbox":if(t(this).attr("checked",""),i.constructor==Array)for(var n in i)i[n]==t(this).val()&&t(this).attr("checked",!0);else i==t(this).val()?t(this).attr("checked",!0):t(this).removeAttr("checked");break;case"radio":i==t(this).val()&&t(this).attr("checked",!0);break;case"select":case"select-one":case"select-multiple":if(t(this).find("option:selected").attr("selected",!1),i.constructor==Array)for(var n in i)t(this).find("option[value='"+i[n]+"']").attr("selected",!0);else t(this).find("option[value='"+i+"']").attr("selected",!0)}}),t("#"+e.elem).attr("loadedInit","true")}}(jQuery);