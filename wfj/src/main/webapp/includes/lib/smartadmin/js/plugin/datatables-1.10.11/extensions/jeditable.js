!function($){$.fn.editable=function(t,e){if("disable"==t)return void $(this).data("disabled.editable",!0);if("enable"==t)return void $(this).data("disabled.editable",!1);if("destroy"==t)return void $(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");var a=$.extend({},$.fn.editable.defaults,{target:t},e),i=$.editable.types[a.type].plugin||function(){},n=$.editable.types[a.type].submit||function(){},l=$.editable.types[a.type].buttons||$.editable.types.defaults.buttons,s=$.editable.types[a.type].content||$.editable.types.defaults.content,o=$.editable.types[a.type].element||$.editable.types.defaults.element,r=$.editable.types[a.type].reset||$.editable.types.defaults.reset,d=a.callback||function(){},p=a.onedit||function(){},u=a.onsubmit||function(){},h=a.onreset||function(){},c=a.onerror||r;return a.tooltip&&$(this).attr("title",a.tooltip),a.autowidth="auto"==a.width,a.autoheight="auto"==a.height,this.each(function(){var t=this,e=$(t).width(),y=$(t).height();$(this).data("event.editable",a.event),$.trim($(this).html())||$(this).html(a.placeholder),$(this).bind(a.event,function(h){if(!0!==$(this).data("disabled.editable")&&!t.editing&&!1!==p.apply(this,[a,t])){h.preventDefault(),h.stopPropagation(),a.tooltip&&$(t).removeAttr("title"),0==$(t).width()?(a.width=e,a.height=y):("none"!=a.width&&(a.width=a.autowidth?$(t).width():a.width),"none"!=a.height&&(a.height=a.autoheight?$(t).height():a.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==a.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),t.editing=!0,t.revert=$(t).html(),$(t).html("");var f=$("<form />");a.cssclass&&("inherit"==a.cssclass?f.attr("class",$(t).attr("class")):f.attr("class",a.cssclass)),a.style&&("inherit"==a.style?(f.attr("style",$(t).attr("style")),f.css("display",$(t).css("display"))):f.attr("style",a.style));var b,m=o.apply(f,[a,t]);if(a.loadurl){var v=setTimeout(function(){m.disabled=!0,s.apply(f,[a.loadtext,a,t])},100),g={};g[a.id]=t.id,$.isFunction(a.loaddata)?$.extend(g,a.loaddata.apply(t,[t.revert,a])):$.extend(g,a.loaddata),$.ajax({type:a.loadtype,url:a.loadurl,data:g,async:!1,success:function(t){window.clearTimeout(v),b=t,m.disabled=!1}})}else a.data?(b=a.data,$.isFunction(a.data)&&(b=a.data.apply(t,[t.revert,a]))):b=t.revert;s.apply(f,[b,a,t]),m.attr("name",a.name),l.apply(f,[a,t]),$(t).append(f),i.apply(f,[a,t]),$(":input:visible:enabled:first",f).focus(),a.select&&m.select(),m.keydown(function(e){27==e.keyCode&&(e.preventDefault(),r.apply(f,[a,t]))});var v;"cancel"==a.onblur?m.blur(function(e){v=setTimeout(function(){r.apply(f,[a,t])},500)}):"submit"==a.onblur?m.blur(function(t){v=setTimeout(function(){f.submit()},200)}):$.isFunction(a.onblur)?m.blur(function(e){a.onblur.apply(t,[m.val(),a])}):m.blur(function(t){}),f.submit(function(e){if(v&&clearTimeout(v),e.preventDefault(),!1!==u.apply(f,[a,t])&&!1!==n.apply(f,[a,t]))if($.isFunction(a.target)&&0==a.flag){var i=a.target.apply(t,[m.val(),a]);$(t).html(i),t.editing=!1,d.apply(t,[t.innerHTML,a]),$.trim($(t).html())||$(t).html(a.placeholder)}else{if(1==a.flag&&$.isFunction(a.target)){var i=a.target.apply(t,[m.val(),a]);a.target=i}var l={};$.isFunction(a.submitdata)?$.extend(l,a.submitdata.apply(t,[t.revert,a])):$.extend(l,a.submitdata),"PUT"==a.method&&(l._method="put"),$(t).html(a.indicator);var s={type:a.method,data:JSON.stringify(l),dataType:"html",url:a.target,success:function(e,i){"html"==s.dataType&&$(t).html(e),t.editing=!1,d.apply(t,[e,a]),$.trim($(t).html())||$(t).html(a.placeholder)},error:function(e,i,n){c.apply(f,[a,t,e])}};$.extend(s,a.ajaxoptions),$.ajax(s)}return $(t).attr("title",a.tooltip),!1})}}),this.reset=function(e){this.editing&&!1!==h.apply(e,[a,t])&&($(t).html(t.revert),t.editing=!1,$.trim($(t).html())||$(t).html(a.placeholder),a.tooltip&&$(t).attr("title",a.tooltip))}})},$.editable={types:{defaults:{element:function(t,e){var a=$('<input type="hidden"/>');return $(this).append(a),a},content:function(t,e,a){$(":input:first",this).val(t)},reset:function(t,e){e.reset(this)},buttons:function(t,e){var a=this;if(t.submit){if(t.submit.match(/>$/))var i=$(t.submit).click(function(){"submit"!=i.attr("type")&&a.submit()});else{var i=$('<button type="submit" />');i.html(t.submit)}$(this).append(i)}if(t.cancel){if(t.cancel.match(/>$/))var n=$(t.cancel);else{var n=$('<button type="cancel" />');n.html(t.cancel)}$(this).append(n),$(n).click(function(i){if($.isFunction($.editable.types[t.type].reset))var n=$.editable.types[t.type].reset;else var n=$.editable.types.defaults.reset;return n.apply(a,[t,e]),!1})}}},text:{element:function(t,e){$("#errorDiv").attr("style","display:none;");var a=$("<input />");return"none"!=t.width&&a.width(t.width),"none"!=t.height&&a.height(t.height),a.attr("autocomplete","off"),$(this).append(a),a}},textarea:{element:function(t,e){var a=$("<textarea />");return t.rows?a.attr("rows",t.rows):"none"!=t.height&&a.height(t.height),t.cols?a.attr("cols",t.cols):"none"!=t.width&&a.width(t.width),$(this).append(a),a}},select:{element:function(t,e){var a=$("<select />");return $(this).append(a),a},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){$(this).val()!=json.selected&&$(this).text()!=$.trim(original.revert)||$(this).attr("selected","selected")})}}},addInputType:function(t,e){$.editable.types[t]=e}},$.fn.editable.defaults={name:"value",id:"id",flag:"flag",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"点击编辑",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery);