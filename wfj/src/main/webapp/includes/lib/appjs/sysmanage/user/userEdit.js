define(["basetools"],function(e){var r=function(r){var t=!1;$("#rolesel").selectpicker({noneSelectedText:" 请选择"}),$("#useredit_form input,textarea").change(function(){t=!0}),$.restAjax({url:$.apiPath+moduleName.role+$.apijoin+"roles?lockStatus=N",type:"get",cache:!1,async:!1,success:function(e){if("200"==e.status&&e.result){for(var r=e.result,t="",o=0;o<r.length;o++)t+="<option value='"+r[o].roleCode+"' text='"+r[o].roleName+"'>"+r[o].roleName+"</option>";$("#rolesel").html(t),$("#rolesel").selectpicker("refresh")}}}),$.restAjax({url:$.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+$("#employeeCode").val(),type:"get",cache:!1,success:function(e){"200"==e.status&&e.result&&($("#useredit_form").json2form({data:e.result}),$("#rolesel").val(e.result.roleCodes),$("#rolesel").selectpicker("render"))}}),$("#useredit_form").validate({errorElement:"em",errorContainer:"#errordiv",errorLabelContainer:"#errortip",rules:{userName:{required:!0,isNotNumber:!0,maxlength:5},mobile:{required:!0,isMobilPhoneNum:!0}},messages:{userName:{required:"请输入用户姓名；",isNotNumber:"用户姓名只能输入汉字和字母；",maxlength:"用户姓名不能超过5个字符；"},mobile:{required:"请输入手机号码；",isMobilPhoneNum:"手机号码不合法；"}},submitHandler:function(t){$("#roleCode").val($("#rolesel").selectpicker("val"));var o=$("#useredit_form").form2json();o=JSON.parse(o),o.agencyCode=agencyCode,o.roleCode=$("#roleCode").val().split(","),o.departmentCode=$("#dept_tree").find(".spanck").closest("li").attr("id")||"-1",o=JSON.stringify(o),$.restAjax({url:$.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+$("#employeeCode").val(),type:"PUT",dataType:"json",data:o,async:!1,success:function(t){"200"==t.status&&($("#user_table").dataTable().fnUpdate(t.result,r,null,!1),$("#useredit_close").click(),e.backTip(t,"Y"))}})}}),$("#useredit_cancel").click(function(){t?$.confirm({title:"确认信息",content:"确认取消当前所做的操作",confirmButton:"是",cancelButton:"否",confirm:function(){$("#useredit_close").click()}}):$("#useredit_close").click()})};return{init:r}});