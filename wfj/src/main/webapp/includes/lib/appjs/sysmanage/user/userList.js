define(["DT","basetools"],function(e,t){function a(){$.app.pageSetUp(),e.createTable("user",{url:$.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+"page?agencyCode="+agencyCode,extra:{bSort:!1},aoColumns:[{sTitle:"userId",mData:"userId",sClass:"center",bVisible:!1},{sTitle:"用户工号",mData:"employeeCode",sClass:"center"},{sTitle:"姓名",mData:"userName",sClass:"center"},{sTitle:"岗位",mData:"roleName",sClass:"center"},{sTitle:"电话",mData:"mobile",sClass:"center"},{sTitle:"锁定状态",mData:"lockStatus",sClass:"center",render:function(e,t,a,s){return"Y"==a.lockStatus?"禁用":"启用"}},{sTitle:"操作",sDefaultContent:"",sClass:"center",render:function(e,t,a,s){var n=["Y"==a.lockStatus?'<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="userLock(\''+a.userId+"','"+s.row+"')\">&nbsp;启用&nbsp;</a>":'<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="userLock(\''+a.userId+"','"+s.row+"')\">&nbsp;禁用&nbsp;</a>",'<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="userEdit(\''+a.userId+"','"+s.row+"')\">&nbsp;编辑&nbsp;</a>"].join("  ");return"<b>"+n+"</b>"}}],toolbar:{buttons:[{btnId:"user_add",title:"创建",callback:function(){$("#user_modal").modal({backdrop:"static",remote:"user/userAdd"})}}]}}),$("#dept_tree").treeview({url:$.apiPath+moduleName.dept+$.apijoin+"departments"+$.apijoin+"tree?agencyCode="+agencyCode,text:"departmentName",id:"departmentCode",persist:"cookie",ajax:{type:"get",cache:!1,beforeSend:function(e){e.setRequestHeader("token",token),e.setRequestHeader("Content-Type","application/json;charset=utf-8")}}}),$(".treeview").on("click","span",function(){$(".treeview span").removeClass("spanck"),$(this).addClass("spanck");var e=$(this).parent().attr("id");"-1"===e&&(e="");var t=$.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+"page?agencyCode="+agencyCode+"&departmentCode="+e;$("#user_table").DataTable().ajax.url(encodeURI(t)).load()}),$("#user_modal").on("hidden.bs.modal",function(){$(this).removeData("bs.modal")})}return this.userLock=function(e,a){$.confirm({title:"确认信息",content:"是否确认当前所做的操作。",confirmButton:"是",cancelButton:"否",confirm:function(){$.restAjax({url:$.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+e+$.apijoin+"lockStatus",type:"put",success:function(e){"200"==e.status&&($("#user_table").dataTable().fnDeleteRow(a,null,!0),t.backTip(e,"Y"))}})}})},this.userEdit=function(e,t){$("#user_modal").modal({backdrop:"static",remote:"user/userEdit?id="+e+"&row="+t})},{userTabinit:a}});