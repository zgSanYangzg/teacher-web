define(["basetools"],function(e){var r=function(){var r=!1;$("#rolename").selectpicker({noneSelectedText:" 请选择"}),$.restAjax({url:$.apiPath+moduleName.role+$.apijoin+"roles?lockStatus=N",type:"get",cache:!1,success:function(e){if("200"==e.status&&e.result){for(var r=e.result,o="",t=0;t<r.length;t++)o+="<option value='"+r[t].roleCode+"' text='"+r[t].roleName+"'>"+r[t].roleName+"</option>";$("#rolename").html(o),$("#rolename").selectpicker("refresh")}}}),$("#useradd_form input,textarea").change(function(){r=!0}),$("#useradd_form").validate({errorElement:"em",errorContainer:"#errordiv",errorLabelContainer:"#errortip",rules:{employeeCode:{required:!0,isNumber:!0,maxlength:5,remote:{type:"get",url:function(){return $.apiPath+moduleName.user+$.apijoin+"employee"+$.apijoin+$("#employeeCode").val()+$.apijoin+"unique?expireToken="+Math.random()},beforeSend:function(e){e.setRequestHeader("token",token),e.setRequestHeader("Content-Type","application/json;charset=utf-8")}}},userName:{required:!0,isNotNumber:!0,maxlength:8},mobile:{required:!0,isMobilPhoneNum:!0}},messages:{employeeCode:{required:" 请输入用户工号；",isNumber:" 用户工号只能输入数字；",maxlength:" 用户工号不能超过5个字符；",remote:"用户工号已存在；"},userName:{required:"请输入用户姓名；",isNotNumber:"用户姓名只能输入汉字和字母；",maxlength:"用户姓名不能超过8个字符；"},mobile:{required:"请输入手机号码；",isMobilPhoneNum:"手机号码不合法；"}},submitHandler:function(r){$("#roleCode").val($("#rolename").selectpicker("val"));var o=$("#useradd_form").form2json();o=JSON.parse(o),o.agencyCode=agencyCode,o.roleCode=$("#roleCode").val().split(","),o.departmentCode=$("#dept_tree").find(".spanck").closest("li").attr("id")||"-1",o=JSON.stringify(o),$.restAjax({url:$.apiPath+moduleName.user+$.apijoin+"employee",type:"POST",dataType:"json",data:o,async:!1,success:function(r){"200"==r.status&&($("#useradd_close").click(),$("#user_table").DataTable().ajax.reload(),e.backTip(r,"Y"))}})}}),$("#useradd_cancel").click(function(){r?$.confirm({title:"确认信息",content:"确认取消当前所做的操作",confirmButton:"是",cancelButton:"否",confirm:function(){$("#useradd_close").click()}}):$("#useradd_close").click()})};return{init:r}});